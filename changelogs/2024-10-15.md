# Catter CLI Tool Changelog

## Added Line and Token Limits

### Why
To provide more control over the amount of content displayed for each file, especially useful for large files or when working with token-sensitive applications.

- Added `--max-lines` flag to limit the number of lines printed per file
- Added `--max-tokens` flag to limit the number of tokens printed per file
- Implemented `applyLimits` method in `FileProcessor` to enforce these limits
- Updated `printFileContent` method to use the new limiting functionality
- These limits are applied after computing full file statistics, ensuring accurate overall stats

These changes allow users to get a preview of file contents while still maintaining accurate overall statistics for the entire file set.

# Markdown Responsive View Implementation

Added a new Markdown Responsive View component and a simple command-line tool to display Markdown files.

- Created `markdownview` package implementing a responsive Markdown viewer
- Implemented `main.go` to create a command-line tool for viewing Markdown files
- The tool supports scrollable view of Markdown content with responsive resizing
- Added ability to toggle between static and scrollable modes using the "/" key
- Enhanced the main view with a border around the Markdown content
- Added display of the current width and height of the view

These changes provide a flexible viewing experience for Markdown files, allowing users to switch between a static view and a scrollable view based on their preference or the content's length. The addition of the border and size display improves the visual presentation and provides useful information about the current view dimensions.

## Glazed Command Tutorial Application

Created a tutorial application demonstrating the use of Glazed for building CLI commands.

- Created project structure in go-go-labs/cmds/tutorials/glazed-command-tutorial
- Implemented GenerateCommand with count, verbose, and prefix flags
- Added YAML configuration for the generate command
- Created main.go to set up the CLI application using Cobra and Glazed
- Demonstrated loading commands from YAML and manual command creation

## 2024-10-15

# Conversation Parent ID Tracking

Improved the HTTPBackend to keep track of the last message's parent ID, ensuring proper conversation structure.

- Added lastParentID field to HTTPBackend struct
- Updated Start method to initialize lastParentID
- Modified handleStart to use lastParentID when ParentID is not provided
- Updated handleDone to set lastParentID to the current message's ID

# Improved Parent ID Handling in Chat Client

Enhanced the chat client to properly handle and convert parent IDs from string input to valid NodeIDs.

- Added stringToNodeID helper function to convert string input to conversation.NodeID
- Updated all command functions to use stringToNodeID for ParentID conversion
- Improved error handling for invalid UUID formats in parent ID input

# Add zerolog logging to HTTPBackend

Added verbose logging to the HTTPBackend struct and its methods to facilitate debugging.

- Imported zerolog package
- Added logger field to HTTPBackend struct
- Set up zerolog logger in NewHTTPBackend to write to /tmp/http-backend.log
- Added logging statements to various methods and handlers
- Logged important information such as message counts, parent IDs, and completion updates

## Improved Logging for HTTP Backend

Added more detailed logging to the HTTP backend to facilitate debugging of error paths and message flow.

- Added error logging for cases when the backend is not running
- Added error logging for failed JSON decoding
- Added info logging for messages sent to the program (h.p)
- Included relevant fields in log messages (messageID, parentID, delta, completion, status)
- Enhanced error logging in the handleError function

# Improve chat-client completion command usability

- Modified the `completion` command in chat-client to use command-line arguments as the delta instead of a flag.
- This change makes it more intuitive and easier for users to input delta text without needing to use a specific flag.

# Enhance chat-client completion command functionality

- Modified the `completion` command in chat-client to append the delta to the completion if provided.
- If no completion is given, the delta is used as both the delta and the completion.
- This change allows for more flexible and intuitive updating of the completion text.

## User Input via HTTP

### Why
To allow external applications to interact with the chat interface by inputting text programmatically.

- Added `InputTextMsg` to user message types
- Implemented `/input-text` endpoint in UserBackend
- Updated model to handle `InputTextMsg` and set text area value
- This change enables HTTP clients to input text as if typed by the user

These changes provide a way for external applications to interact with the chat interface programmatically, enhancing the tool's flexibility and integration capabilities.

## Integrated HTTP Server for User Frontend and Backend

### Why
To provide a unified HTTP interface for both user interactions and backend operations, improving the overall architecture and simplifying the setup.

- Modified `main.go` to set up a single HTTP server with separate routes for user frontend and backend
- Updated `HTTPBackend` in `http-backend.go` to use a subrouter instead of creating its own server
- Exposed user frontend (from `user-backend.go`) under the `/user` route
- Moved HTTP backend (from `http-backend.go`) under the `/backend` route
- Added logging for the user backend

These changes provide a more cohesive HTTP interface for the chat application, allowing easier management and potential expansion of both user-facing and backend functionalities.

## Extended Chat Client for User Backend Interaction

### Why
To provide a comprehensive command-line interface for interacting with both the chat backend and the user interface, improving the testing and debugging capabilities of the Bobatea chat application.

- Created separate command groups for backend and user interactions
- Added new commands for all user interface actions:
  - toggle-help
  - unfocus-message
  - quit
  - focus-message
  - select-next-message
  - select-prev-message
  - submit-message
  - copy-to-clipboard
  - copy-last-response
  - copy-last-source-blocks
  - copy-source-blocks
  - save-to-file
  - cancel-completion
  - dismiss-error
  - input-text
- Implemented `sendUserRequest` function to handle user interface requests
- Updated main function to organize commands into backend and user groups

These changes provide a more structured and comprehensive command-line interface for interacting with the Bobatea chat application, allowing for easier testing and debugging of both backend and user interface functionalities.

# Job Reports Types

Added new types for parsing job report data.

- Created new file `go-go-labs/pkg/job-reports/types.go`
- Defined `JobStatus`, `Resource`, `Job`, and `ReportData` types
- Structured types to match the provided job report format
- Included fields for efficiency metrics (CPU, RAM, and WallTime)

# Job Reports Parser Implementation

Added a parser for job report data with an intermediate API.

- Created new file `go-go-labs/pkg/job-reports/parser.go`
- Implemented `ParseJobReport` function that takes an `io.Reader` as input
- Added `parseJobLine` helper function to parse individual job entries
- Implemented `ParseJobReportFile` function to parse job reports from files
- Added helper functions for parsing durations and percentages
- The parser can handle the specific format of the job report, including all fields and their respective data types

# Filewalker Package Updates

## Improved Relative Path Handling

### Why
To enhance the robustness of the Walker when dealing with both absolute and relative paths, ensuring consistent behavior across different operating systems and file systems.

### Changelog
- Modified `Walker` struct to store the current working directory
- Updated `NewWalker` function to initialize the current working directory
- Implemented `resolveRelativePath` method to convert relative paths to absolute paths
- Updated `walkFS` method to use `resolveRelativePath` when processing input paths
- Added new test cases to verify the correct handling of relative and absolute paths
- Updated documentation to reflect the new relative path handling capabilities

These changes improve the Walker's ability to handle various path inputs consistently, making it more reliable and easier to use across different environments.

# Refactor FileProcessor to use a dedicated FileFilter struct

## Why
To improve modularity and reusability of the file filtering logic, and to make it compatible with the filewalker.Node from walker.go.

- Created a new `FileFilter` struct that encapsulates all filtering options
- Implemented a `Filter` method on `FileFilter` that takes a `filewalker.Node`
- Moved filtering logic from `FileProcessor` to `FileFilter`
- Updated `FileProcessor` to use the new `FileFilter` struct
- Ensured compatibility with both file system operations and the filewalker package

# Refactor FileFilter to provide separate FilterNode and FilterPath functions

## Why
To improve flexibility and usability of the file filtering logic, allowing it to be used with both filewalker.Node objects and file paths as strings.

- Modified `FileFilter` struct to include two separate filter functions:
  - `FilterNode`: Takes a `filewalker.Node` as input
  - `FilterPath`: Takes a file path string as input
- Updated `FileProcessor` to use the new `FilterPath` function
- Ensured compatibility with both file system operations and the filewalker package
- This change allows the filter to be used in more diverse contexts, improving its reusability

## [Unreleased]

### Added
- Implemented options initialization scheme for FileFilter
- Implemented options initialization scheme for FileProcessor
- Added WithFileFilter option to FileProcessor

### Changed
- Updated runCatter function to use new options initialization schemes
- FileProcessor now only filters paths if a FileFilter is provided

### Improved
- Enhanced flexibility and configurability of FileFilter and FileProcessor
- Simplified initialization of FileFilter and FileProcessor in runCatter function

## Enhanced File Filtering and Logging

Added new features to improve visibility into the file filtering process:

- Added a method to print configured filters in the FileFilter struct
- Implemented verbose logging option for filtered/unfiltered paths
- Exposed new flags in the CLI: --print-filters and --verbose (-v)

These changes provide users with more control and insight into the file selection process, making it easier to debug and fine-tune the catter tool's behavior.

# Improve file filtering in catter application

Enhanced the file filtering mechanism in the catter application for better error handling and encapsulation.

- Modified `shouldProcessFile` function to compute `fileInfo` internally instead of receiving it as a parameter.
- Added error handling for file stat operations in `shouldProcessFile`.
- Updated `FilterPath` method to reflect changes in `shouldProcessFile`.

## File Filter YAML Serialization

Added YAML serialization and deserialization support for FileFilter configurations.

- Added `ToYAML()` method to serialize FileFilter to YAML format
- Added `FromYAML()` function to deserialize YAML data into a FileFilter
- Added `SaveToFile()` method to save FileFilter configuration to a YAML file
- Added `LoadFromFile()` function to load FileFilter configuration from a YAML file
- These changes allow users to easily save, load, and share FileFilter configurations

## YAML Configuration for File Filters

Added support for YAML-based configuration of file filters and the ability to print current filter settings as YAML.

- Added `--filter-yaml` flag to specify a YAML file containing initial filter configuration
- Added `--print-filter-yaml` flag to print the current filter configuration as YAML and exit
- Implemented loading of filter configuration from YAML file in `runCatter`
- Added `applyFlagOverrides` function to apply command-line flag overrides to the filter configuration
- Updated `FileProcessor` creation to use the new `WithFileFilter` option
- These changes allow users to easily save, load, and share complex filter configurations while maintaining the ability to override settings via command-line flags

## Improved YAML Serialization for FileFilter

Enhanced the YAML serialization of FileFilter to exclude default values and improve configuration management.

- Added `omitempty` tags to FileFilter struct fields to exclude zero values from YAML output
- Moved default values (DefaultExcludedExts, DefaultExcludedDirs, DefaultExcludedMatchFilenames) out of YAML serialization
- Modified FromYAML function to start with a new FileFilter with default values before applying YAML configuration
- Excluded GitIgnoreFilter from YAML serialization due to its runtime initialization nature
- These changes result in cleaner, more focused YAML configurations that only include non-default settings

# Filter Profiles Support

Added support for filter profiles in the YAML configuration file. This allows users to define multiple filter configurations and easily switch between them using the `--filter-profile` flag.

- Added `--filter-profile` flag to specify the profile name
- Updated `FileFilter` struct to include a `Profiles` field
- Implemented `loadFileFilter` function to handle profile selection
- Modified `FromYAML` function to initialize default values for profiles

# Default Filter Configuration File

## Why
To improve user experience by providing a default configuration file location, making it easier for users to set up and maintain filter configurations.

- Added support for a default `.catter-filter.yaml` file in the current directory
- Modified `loadFileFilter` function to check for `.catter-filter.yaml` if no filter YAML path is specified

# Environment Variable for Default Profile

## Why
To provide a convenient way for users to set a default filter profile without modifying command-line arguments, improving ease of use across different environments.

- Added support for `CATTER_PROFILE` environment variable to set the default filter profile
- Modified `runCatter` function to check for `CATTER_PROFILE` when the `filter-profile` flag is not set
- Maintained priority of command-line flags over environment variables for flexibility

## Binary File Filtering

Added an option to filter out binary files in the filefilter package and a corresponding flag in the catter command.

- Added `FilterBinaryFiles` option to `FileFilter` struct
- Implemented `WithFilterBinaryFiles` option for `NewFileFilter`
- Added binary file detection logic in `shouldProcessFile` method
- Implemented `isBinaryFile` helper function to detect binary files
- Added `--filter-binary` flag to catter command (default: true)

# Restore filter profile functionality

## Why
To allow users to easily switch between different predefined filter configurations.

- Added `--filter-profile` flag to specify a filter profile
- Implemented environment variable `CATTER_PROFILE` as an alternative way to specify the profile
- Updated `runCatter` function to apply the specified profile if it exists in the loaded configuration

# Refactor Profile Filtering in FileFilter

## Why
To improve modularity and simplify the usage of filter profiles across different applications.

- Modified `LoadFromFile` function in `filefilter` package to accept a profile string argument
- Moved profile filtering logic from `catter` command to `LoadFromFile` function
- Updated `runCatter` function to use the new `LoadFromFile` signature
- Ensured that profile FileFilters inherit default values from the main configuration
- Simplified profile handling in the `catter` command
- Maintained support for default `.catter-filter.yaml` file and `CATTER_PROFILE` environment variable

These changes make the profile filtering functionality more reusable and easier to maintain, while keeping the same behavior from the user's perspective.

# Townfusion Scraper

## Initial implementation of Providence Recorder of Deeds scraper

Added a Python script to scrape the Providence Recorder of Deeds website. The script allows users to perform searches with various parameters and paginate through results. It handles search execution, result retrieval, and presents the data in a tabulated format.

- Created `scraper.py` with functionality to perform searches and retrieve results
- Implemented command-line argument parsing for search parameters and pagination
- Added result parsing and tabulation using BeautifulSoup and tabulate
- Hardcoded cookies for authentication (to be replaced with a more secure method in the future)
